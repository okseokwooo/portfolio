서버프로그래밍 자유주제 과제로 모의 주식 프로그램을 만들었다. 실제 주식 내용을 가져오는 것은 한계가 있기 때문에 주식 이름과 주식을 사고파는 사람들을 임의로 정했다. 각 구성요소 들을 살펴보면 데이터베이스는 크게 COMPANY(주식회사), AI(주식을 사고파는 임의에 사람들), USER_STOCK(사용자)로 구성되어 있다. 이 보고서에서는 모의 주식 프로그램에 구성 php들과 css등을 알아본다. 

 sql구문을 먼저 살펴보면 ai.sql, company.sql, user_stock.sql로 구성되어 있다. ai는 주식을 사고파는 사람들을 임의로 정해 둔 것으로 가지고 있는 돈에 따라 flex집단, rich집단, normal집단, poor집단으로 구성되어 있다. 각각의 이름 및 아이디는 책에 있는 예제를 참고하였고, 번호가 1~5번인 사람은 10억(flex)에 해당하고, 6~10번인 사람은 5억(rich)에 해당하고, 11~26번인 사람은 1천만원(normal)에 해당하고, 27~35번인 사람은 1백만원(poor)에 해당한다. 각각 아이디 및 가지고 있는 주식, 주식의 개수, 자산 등으로 테이블을 구성하였다. company또한 번호로 초기 주가가 높은 회사부터 초기 주가가 낮은 회사까지 나눴다. 주식회사의 이름은 동물 이름으로 설정 하였고, 1~3번은 초기주가 금액이 1주당 10만원이고, 4~13번까지는 초기주가 금액이 1주당 5만원이고, 14~29번까지는 초기주가 금액이 1주당 1만원이고, 30~35번까지는 초기주가 금액이 1주당 5천원으로 구성하였다. 테이블은 회사의 이름, 초기주가 금액, 주식의 개수 등으로 구성하였다. User_stock.sql은 아이디, 비밀번호, 이름, 자산(첫 로그인 할 시 1백만원이 지급된다.), 가지고 있는 주식의 개수, 가지고 있는 주식의 이름 등으로 구성되어 있다.
 
 
<img width="500" alt="1" src="https://user-images.githubusercontent.com/79968300/177317758-da0647cc-e5be-4a2b-9aa8-4ff4e66766e3.PNG">



 페이지를 구성하고 있는 php구문에 대하여 알아보도록 한다. 먼저 돈에 따라 나눈 각각에 ai.php부터 알아보면 flex_buy_stock.php 부터 poor_buy_stock.php까지 있다. 대표적으로 flex_buy_stock.php는 데이터 베이스에서 1~5번에 해당하는 ai들 중 랜덤으로 한 명을 선택하여 주식을 일정 확률에 의해 사게 만들었다. 이때 company 데이터베이스에서도 랜덤하게 한 개의 회사를 생성한다. flex_ai가 주식을 살 확률은 1%이다. poor_ai로 내려 갈 때마다 주식을 살 확률이 늘어난다. Ai가 가지고 있는 돈과 주가를 비교하여 주식을 사게 되는데 한 번 주식을 살 때마다 700개씩 산다. 이는 poor_ai로 갈수록 축소된다. 그렇기 때문에 flex_ai가 움직이게 되면 주가에 큰 변동이 있다. Ai는 주식을 사는 행동을 1%확률로 사기 때문에 1%확률이 안되었다고 해서 페이지가 만료가 되면 안되기 때문에 페이지를 계속 새로고침 하면서 계속해서 작동을 한다. 주식을 사는 기능이 있으면 주식을 파는 기능도 있어야 주가 변동이 원할하게 일어나기 때문에 flex_sell_stock.php 부터 poor_sell_stock.php까지 생성을 한다. 주식을 팔때는 flex_buy_stock.php를 include하여 주식을 가지고 있을 시 동작을 하도록 한다. 살 때 또한 주식을 가지고 있는 ai중 한 명을 랜덤하게 뽑는다. 하지만 company에 접근할 때는 ai가 산 주식에 이름과 같아야 팔 수 있게 설정을 했다. 파는 확률 또한 1%이며, poor_ai로 갈수록 확률은 증가한다. 살 때도 700개씩 거래를 하며 이는 poor_ai로 갈수록 축소하고, flex_buy_stock.php와 동일하게 페이지를 계속 새로고침하여 동작하게 한다. 

주식사이트를 접속하면 보이는 my_index.php에서는 모든 ai들이 하는 동작들을 include를 사용하여 다 받는다. 주식의 이름, 가격, 개수를 테이블을 이용하여 만들었다. 주가가 ai에의해 변동하기 때문에 이를 보여주기 위해서 my_index.php를 2초마다 한 번씩 새로고침을 한다. 메인 페이지에 상단에는 회원가입, 로그인, HOME 버튼으로 구성되어 있고, 이는 header.php를 통해 만들었다. Header.php는 css를 활용하여 꾸몄고, 세션을 생성하여 사용자의 정보를 생성한다. 

 주식사이트를 이용하기 위해서는 먼저 회원가입을 해야 한다. 회원가입은 아이디, 비밀번호, 이름을 입력하여 가입을 할 수 있다. 아이디는 중복체크 과정을 거쳐야 하고, 비밀번호는 비밀번호 확인란을 만들어 비밀번호가 동일할 때만 가입이 가능하게 만들었다. 회원가입 과정을 하였으면 로그인을 해야 하는데 만약 회원가입을 한 정보와 다른 아이디 및 비밀번호를 입력하였을 경우에는 로그인이 되지 않으며 정확한 정보를 입력해야만 로그인이 가능하다. 로그인 후 로그아웃 버튼을 누르면 세션이 종료된다. 첫 로그인을 하였을 때 1백만원이 지급되고 이 1백만원을 통하여 시세가 바뀌는 주식을 사거나 팔 수 있다. 

 사용자가 주식을 살 때는 my_index.php에 주식 이름에 a링크를 걸어 주식 이름을 입력하면 그에 해당하는 주식을 사거나 팔 수 있는 페이지로 이동하게 된다. 여기서 사용자는 수량을 고르게 된다. 이 수량 값을 GET방식을 이용하여 넘겨주고, 주식의 이름은 임의로 만든 세션에 저장하여 넘겨준다. 만약 사용자가 가진 돈보다 주가에 수량을 곱한 값이 더 크면 “돈이 부족합니다!” 라는 경고문이 나오게 된다. 그것이 아니라면 주식을 살 수 있게 된다. 사용자는 돈이 줄어들고, 주가는 올라가게 되고, 사용자가 산 주식 이름 및 개수가 업데이트 된다. 그리고 메인 페이지로 이동하게 된다. 사용자가 주식을 팔 때 역시 똑같이 이름을 클릭한 뒤 수량을 골라 판매버튼을 누른다. 이때, 사용자가 가지고 있는 주식의 이름과 사용자가 선택한 주식의 이름이 다르거나, 주식의 개수가 남아있지 않거나, 가지고 있는 주식의 개수보다 수량을 더 높게 선택할 경우 “잘못된 경로입니다.” 라는 경고문이 나온다. 그것이 아니라면 사용자는 가지고 있는 주식을 팔게 되고 주가 및 사용자 정보가 업데이트 된다.
